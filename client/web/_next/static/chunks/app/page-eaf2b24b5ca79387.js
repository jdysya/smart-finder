(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5588:(e,s,n)=>{Promise.resolve().then(n.bind(n,6845))},6845:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>g});var a=n(3815),t=n(5007),i=n(3213),l=n(7832),r=n(9079),c=n(9018),d=n(9848),h=n(3582),o=n(4230),x=n(453),j=n(9877),p=n(4397),m=n(768),u=n(139),f=n(6169);function g(){let[e,s]=(0,t.useState)([]),[n,g]=(0,t.useState)(""),[b,S]=(0,t.useState)({}),[v,C]=(0,t.useState)([]),[N,w]=(0,t.useState)(""),[T,y]=(0,t.useState)(""),[k,E]=(0,t.useState)(""),[L,O]=(0,t.useState)(1),[_,U]=(0,t.useState)(20),[z,P]=(0,t.useState)(0),[D,Z]=(0,t.useState)(""),I=()=>{fetch("/api/directories").then(e=>e.json()).then(s)},F=()=>{fetch("/api/status").then(e=>e.json()).then(S)},J=()=>{let e=new URLSearchParams({page:String(L),pageSize:String(_)});N&&e.append("search",N),fetch("/api/files?".concat(e.toString())).then(e=>e.json()).then(e=>{C(e.files||[]),P(e.total||0)})},M=()=>{fetch("/api/ignore-patterns").then(e=>e.json()).then(e=>Z(e.join("\n")))};(0,t.useEffect)(()=>{I(),F(),J(),M();let e=setInterval(F,1500);return()=>clearInterval(e)},[]),(0,t.useEffect)(()=>{J()},[L,_,N]);let R=e=>{fetch("/api/directories",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})}).then(I)},B=v.filter(e=>e.filename.toLowerCase().includes(N.toLowerCase())||e.path.toLowerCase().includes(N.toLowerCase()));return(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Smart Finder"}),(0,a.jsxs)(c.Z,{className:"mb-4",children:[(0,a.jsx)(d.d,{children:"监控目录"}),(0,a.jsxs)(h.U,{children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,a.jsx)(l.r,{value:n,onChange:e=>g(e.target.value),placeholder:"输入目录路径"}),(0,a.jsx)(i.T,{onClick:()=>{fetch("/api/directories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n})}).then(()=>{g(""),I()})},children:"添加目录"})]}),(0,a.jsx)("ul",{children:e.map(e=>(0,a.jsxs)("li",{className:"flex justify-between items-center p-2 bg-gray-100 rounded mb-1",children:[(0,a.jsx)("span",{children:e}),(0,a.jsx)(i.T,{color:"danger",size:"sm",onClick:()=>R(e),children:"删除"})]},e))})]})]}),(0,a.jsxs)(c.Z,{className:"mb-4",children:[(0,a.jsx)(d.d,{children:"状态"}),(0,a.jsx)(h.U,{children:b.indexing?(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:["Indexing: ",b.indexingDone," / ",b.indexingTotal," files"]}),(0,a.jsx)(o.o,{value:b.indexingDone/b.indexingTotal*100})]}):(0,a.jsxs)("p",{children:["索引数量: ",b.fileCount]})})]}),(0,a.jsxs)(c.Z,{className:"mb-4",children:[(0,a.jsx)(d.d,{children:"路径转换"}),(0,a.jsxs)(h.U,{children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,a.jsx)(l.r,{value:T,onChange:e=>y(e.target.value),placeholder:"输入文件完整路径"}),(0,a.jsx)(i.T,{onClick:()=>{fetch("/api/path2url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:T})}).then(async e=>{if(e.ok){let s=await e.json();E("MD5: ".concat(s.md5," | URL: ").concat(s.url))}else{let s=await e.text();E("Error: ".concat(s))}}).catch(e=>E("Error: ".concat(e.message)))},children:"转换"})]}),k&&(0,a.jsx)("p",{children:k})]})]}),(0,a.jsxs)(c.Z,{className:"mb-4",children:[(0,a.jsx)(d.d,{children:"忽略规则"}),(0,a.jsxs)(h.U,{children:[(0,a.jsx)(r.P,{value:D,onChange:e=>Z(e.target.value),placeholder:"输入忽略规则，一行一个",rows:10}),(0,a.jsx)(i.T,{onClick:()=>{fetch("/api/ignore-patterns",{method:"POST",headers:{"Content-Type":"text/plain"},body:D}).then(()=>alert("忽略规则已保存"))},className:"mt-2",children:"保存规则"})]})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(d.d,{children:"索引文件"}),(0,a.jsxs)(h.U,{children:[(0,a.jsx)(l.r,{className:"mb-2",placeholder:"搜索文件...",value:N,onChange:e=>{w(e.target.value),O(1)}}),(0,a.jsxs)("div",{className:"flex gap-2 my-2 items-center",children:[(0,a.jsx)(i.T,{size:"sm",disabled:1===L,onClick:()=>O(L-1),children:"上一页"}),(0,a.jsxs)("span",{children:["第 ",L," 页 / 共 ",Math.max(1,Math.ceil(z/_))," 页"]}),(0,a.jsx)(i.T,{size:"sm",disabled:L*_>=z,onClick:()=>O(L+1),children:"下一页"}),(0,a.jsx)("span",{className:"ml-4",children:"每页"}),(0,a.jsx)("select",{value:_,onChange:e=>{U(Number(e.target.value)),O(1)},className:"border rounded px-1 py-0.5",children:[10,20,50,100].map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("span",{children:"条"})]}),(0,a.jsxs)(x.j,{"aria-label":"Indexed Files",children:[(0,a.jsxs)(j.X,{children:[(0,a.jsx)(p.e,{children:"文件名"}),(0,a.jsx)(p.e,{children:"路径"}),(0,a.jsx)(p.e,{children:"大小"}),(0,a.jsx)(p.e,{children:"修改时间"}),(0,a.jsx)(p.e,{children:"操作"})]}),(0,a.jsx)(m.E,{children:B.map(e=>(0,a.jsxs)(u.s,{children:[(0,a.jsx)(f.w,{children:e.filename}),(0,a.jsx)(f.w,{children:e.path}),(0,a.jsxs)(f.w,{children:[(e.size/1024).toFixed(2)," KB"]}),(0,a.jsx)(f.w,{children:new Date(e.modified_at).toLocaleString()}),(0,a.jsx)(f.w,{children:(0,a.jsx)(i.T,{as:"a",href:"/md5?hash=".concat(e.md5),target:"_blank",size:"sm",children:"打开"})})]},e.md5))})]})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[529,396,719,892,358],()=>s(5588)),_N_E=e.O()}]);